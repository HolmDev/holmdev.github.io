<!doctype html><html><head><title>Creating an RGB Keyboard Legend</title><meta name=description content="Creating an RGB Keyboard Legend"><meta name=author content><meta charset=utf-8><meta name=viewport content="width=1100"><link rel=stylesheet type=text/css href=/style.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png></head><body><div class=container><div class=header><div class=logo><a href=https://holmdev.github.io>Fredholm</a></div><div class=nav><a href=/about/>about</a>
<a href=/links/>links</a></div></div><div class=content><div class=appellation><h1>Creating an RGB Keyboard Legend</h1><h3 class=date>Published: 2022-06-15</h3><h3 class=author>By: Fredholm</h3></div><p>I recently found <a href=https://libreddit.spike.codes/r/unixporn/comments/hgba3b/i3_razer_blade_stealth_highlighting_shortcuts_and/>this</a> post, where user u/Rasie1 had created a script for displaying their i3 keybinds when certain modifier keys were pressed. I thought it looked really dope and that it would fit nicely with the rest of my keyboard-centric setup, so I made my own.</p><p>I decided to use <a href=https://openrgb.org/>OpenRGB</a> for controlling my Blackwidow V2&rsquo;s RGB, since it fits my needs very well and has been my main RGB solution since the beginning of my Linux journey. I also decided to write the program in python, since I could finish it quite quickly then.</p><p>I decided to tackle this task by letting OpenRGB switch between different modes corresponding to certain combinations of modifier keys. That way I could customize the lights with a GUI instead of messing with a YAML/JSON file that would get really messy really fast.</p><p>During a first run, the program will create the needed profiles in OpenRGB. After that, you can go in and customize them in the OpenRGB application.</p><h3 class=important id=important>Important</h3><p>You need to have the OpenRGB server running for this program to work. Launch it with the <code>--server</code> option to start the server.</p><p>The code is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/bin/python</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>openrgb</span> <span class=kn>import</span> <span class=n>OpenRGBClient</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pynput.keyboard</span> <span class=kn>import</span> <span class=n>Key</span><span class=p>,</span> <span class=n>Listener</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Handler</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>mod</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>ctrl</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>shift</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>rgb</span> <span class=o>=</span> <span class=n>OpenRGBClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&#34;Mod&#34;</span><span class=p>,</span> <span class=s2>&#34;Mod+Shift&#34;</span><span class=p>,</span> <span class=s2>&#34;Mod+Ctrl&#34;</span><span class=p>,</span> <span class=s2>&#34;None&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>			<span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=bp>self</span><span class=o>.</span><span class=n>rgb</span><span class=o>.</span><span class=n>load_profile</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=bp>self</span><span class=o>.</span><span class=n>rgb</span><span class=o>.</span><span class=n>save_profile</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=nf>updateKeys</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>press</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>key</span> <span class=o>==</span> <span class=n>Key</span><span class=o>.</span><span class=n>cmd</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=bp>self</span><span class=o>.</span><span class=n>mod</span> <span class=o>=</span> <span class=n>press</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>key</span> <span class=o>==</span> <span class=n>Key</span><span class=o>.</span><span class=n>ctrl</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=bp>self</span><span class=o>.</span><span class=n>ctrl</span> <span class=o>=</span> <span class=n>press</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>key</span> <span class=o>==</span> <span class=n>Key</span><span class=o>.</span><span class=n>shift</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=bp>self</span><span class=o>.</span><span class=n>shift</span> <span class=o>=</span> <span class=n>press</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>choose_profile</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=nf>choose_profile</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>mod</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>shift</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>ctrl</span><span class=p>):</span>
</span></span><span class=line><span class=cl>				<span class=bp>self</span><span class=o>.</span><span class=n>rgb</span><span class=o>.</span><span class=n>load_profile</span><span class=p>(</span><span class=s2>&#34;Mod&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>shift</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=bp>self</span><span class=o>.</span><span class=n>rgb</span><span class=o>.</span><span class=n>load_profile</span><span class=p>(</span><span class=s2>&#34;Mod+Shift&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>ctrl</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=bp>self</span><span class=o>.</span><span class=n>rgb</span><span class=o>.</span><span class=n>load_profile</span><span class=p>(</span><span class=s2>&#34;Mod+Ctrl&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=bp>self</span><span class=o>.</span><span class=n>rgb</span><span class=o>.</span><span class=n>load_profile</span><span class=p>(</span><span class=s2>&#34;None&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>h</span> <span class=o>=</span> <span class=n>Handler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=nf>on_press</span><span class=p>(</span><span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>h</span><span class=o>.</span><span class=n>updateKeys</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=nf>on_release</span><span class=p>(</span><span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>h</span><span class=o>.</span><span class=n>updateKeys</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>with</span> <span class=n>Listener</span><span class=p>(</span><span class=n>on_press</span><span class=o>=</span><span class=n>on_press</span><span class=p>,</span> <span class=n>on_release</span><span class=o>=</span><span class=n>on_release</span><span class=p>)</span> <span class=k>as</span> <span class=n>listener</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>listener</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></div><p>Result:
<img src=result.gif alt=Result></p><h3 class=note id=note>Note</h3><p>It is also quite nice to have it launch on startup, so I made a special .desktop file that launches OpenRGB with the <code>--server</code> option alongside this program and placed it in <code>~/.config/autostart/</code>.</p></div></div></body></html>