<!doctype html><html><head><title>Fetching Xresources made simple</title><meta name=description content="Fetching Xresources made simple"><meta name=author content><meta charset=utf-8><meta name=viewport content="width=1100"><link rel=stylesheet type=text/css href=/style.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png></head><body><div class=container><div class=header><div class=logo><a href=https://holmdev.github.io>Fredholm</a></div><div class=nav><a href=/about/>about</a>
<a href=/links/>links</a></div></div><div class=content><div class=appellation><h1>Fetching Xresources made simple</h1><h3 class=date>Published: 2022-10-30</h3><h3 class=author>By: Fredholm</h3></div><p>As can be seen in previous posts, I use a standalone window manager. I really love being in control of every little small thing and building things myself. I have also really grown to like when systems work together and especially when they work together <em>dynamically</em>. One of these systems is Xresources, which have allowed me to sync my themes over multiple applications/WMs. However, not every application/WM has support for accessing and trying to hack together a solution for connecting them is suboptimal. This is an excerpt from one of my previous Qtile configs.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># {{{ Xresources hack</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>xfetch</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=s2>&#34;sh -c &#39;xrdb -merge ~/.Xresources &amp;&amp; xrdb -q&#39;&#34;</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span> <span class=n>shell</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>xoutput</span><span class=p>,</span> <span class=n>xerr</span><span class=p>)</span> <span class=o>=</span> <span class=n>xfetch</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>xfetch</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>xrdb</span> <span class=o>=</span> <span class=n>xoutput</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>splitlines</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>xdict</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>xrdb</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>temp</span> <span class=o>=</span> <span class=n>i</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;:</span><span class=se>\t</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>xdict</span><span class=p>[</span><span class=n>temp</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span> <span class=o>=</span> <span class=n>temp</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>xrdb</span> <span class=o>=</span> <span class=n>xdict</span>
</span></span><span class=line><span class=cl><span class=c1># }}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>widget_defaults</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>font</span><span class=o>=</span><span class=n>xrdb</span><span class=p>[</span><span class=s2>&#34;*font_type&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>	<span class=n>fontsize</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>xrdb</span><span class=p>[</span><span class=s2>&#34;*font_size&#34;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>	<span class=n>padding</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>background</span><span class=o>=</span><span class=n>xrdb</span><span class=p>[</span><span class=s2>&#34;*background&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>	<span class=n>foreground</span><span class=o>=</span><span class=n>xrdb</span><span class=p>[</span><span class=s2>&#34;*foreground&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>There are several problems with this. First of, it&rsquo;s just ugly. Secondly, it creates a dependency of using shell subprocesses. Thirdly and most importantly, it lacks the support for wildcards, which is one of Xresources most beautiful features. But what is the solution to this. Should we just accept our fates, doomed to manually update our configs when we want to switch color schemes?</p><p>No, because I have created a tool for fetching Xresources in style.</p><p>Introducing, <a href=https://pypi.org/project/xrcat/>xrcat</a>, a CLI tool and Python module combo that allow you to access Xresources with a single command.</p><p>To install it just run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ pip install xrcat
</span></span></code></pre></div><p>Here you can see its usage as a CLI tool:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ xrcat dk.background
</span></span><span class=line><span class=cl><span class=c1>#1d2021</span>
</span></span></code></pre></div><p>Or in a python scripts:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>xrcat</span> <span class=kn>import</span> <span class=n>xrcat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Load current resources into xrcat</span>
</span></span><span class=line><span class=cl><span class=n>xrcat</span><span class=o>.</span><span class=n>updateResources</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Get the resource</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>xrcat</span><span class=o>.</span><span class=n>getResource</span><span class=p>(</span><span class=s2>&#34;qtile.background&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1># Output: &#39;#1d2021&#39;</span>
</span></span></code></pre></div><p>The nice thing with this tool is that it support wildcards. This means that if you for example want <code>dwm.background</code> and the value of it is None, xrcat will match it to <code>*.background</code>. Matches are prioritized based on length so for the example above <code>*.background</code> will be chosen instead of <code>*background</code> even though both are matches. This behavior is implemented to ensure that program specific resources are selected before general resources.</p><p>This mean that my abysmal Qtile config from above can be trimmed down to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>xrcat</span> <span class=kn>import</span> <span class=n>xrcat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>xrcat</span><span class=o>.</span><span class=n>updateResources</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>widget_defaults</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>font</span><span class=o>=</span><span class=n>xrcat</span><span class=o>.</span><span class=n>getResource</span><span class=p>(</span><span class=s2>&#34;qtile.font_type&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=n>fontsize</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>xrcat</span><span class=o>.</span><span class=n>getResource</span><span class=p>(</span><span class=s2>&#34;qtile.font_size&#34;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>	<span class=n>padding</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>background</span><span class=o>=</span><span class=n>xrcat</span><span class=o>.</span><span class=n>getResource</span><span class=p>(</span><span class=s2>&#34;qtile.background&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=n>foreground</span><span class=o>=</span><span class=n>xrcat</span><span class=o>.</span><span class=n>getResource</span><span class=p>(</span><span class=s2>&#34;qtile.foreground&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>I also use it in my dk config like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>dkcmd <span class=nb>set</span> border <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=nv>width</span><span class=o>=</span><span class=k>$(</span>xrcat dk.border_width<span class=k>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	colour <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=nv>focus</span><span class=o>=</span><span class=k>$(</span>xrcat dk.color4<span class=k>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=nv>unfocus</span><span class=o>=</span><span class=k>$(</span>xrcat dk.color0<span class=k>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	<span class=nv>urgent</span><span class=o>=</span><span class=k>$(</span>xrcat dk.color1<span class=k>)</span>
</span></span></code></pre></div><p>While I haven&rsquo;t tried out converting every last non-compliant application to use xrcat, I reckon quite a few could be configured with it. Of course this won&rsquo;t cover all possible applications, but combining Xresources, xrcat, pywal, and Oomox/Themix probably covers a vast majority of what you would want to configure.</p><p>Feel free to check out the project on <a href=https://github.com/HolmDev/xrcat>Github</a> if you would like to contribute!</p></div></div></body></html>